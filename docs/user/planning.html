
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Planning using Trident’s Designer &#8212; Trident 0.0.34a documentation</title>
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Sample Browsing using Trident" href="browsing.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="browsing.html" title="Sample Browsing using Trident"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installation"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Trident 0.0.34a documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><p class="sidebar-subtitle">
    <a href="../index.html">
        <h1>Trident</h1>
        <h2>0.0.34a</h2>
    </a>
</p>

<p>
    Trident is a python scripting API wrapper for Aquarium. With Trident,
    you can create python scripts and apps that mine data, create samples,
    submit laboratory protocols, and more. You are looking at documentation
    for version <b>0.0.34a</b>.
</p>
<div>
    <a href="https://circleci.com/gh/klavinslab/trident/tree/master"><img src="https://circleci.com/gh/klavinslab/trident.svg?style=svg" alt="build status"></a>
    <a href="https://badge.fury.io/py/pydent"><img src="https://badge.fury.io/py/pydent.svg" alt="PyPI version" height="18"></a>
</div>
  <h4>Previous topic</h4>
  <p class="topless"><a href="installation.html"
                        title="previous chapter">Installation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="browsing.html"
                        title="next chapter">Sample Browsing using Trident</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/user/planning.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="planning-using-trident-s-designer">
<h1>Planning using Trident’s Designer<a class="headerlink" href="#planning-using-trident-s-designer" title="Permalink to this headline">¶</a></h1>
<p>Trident provides a class to help with creating Aquarium plans, called the “planner”</p>
<p>Features: topological sorting, plan optimizer, drawing</p>
<p>You can draw existing plans (colors represent Operation statuses, legend to come…):</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="kn">from</span> <span class="nn">pydent</span> <span class="k">import</span> <span class="n">planner</span>
<span class="n">canvas</span> <span class="o">=</span> <span class="n">planner</span><span class="o">.</span><span class="n">Planner</span><span class="p">(</span><span class="n">mysession</span><span class="p">,</span> <span class="n">plan_id</span><span class="o">=</span><span class="mi">12345</span><span class="p">)</span>
<span class="n">canvas</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/CanvasDrawExample1.png" src="../_images/CanvasDrawExample1.png" />
<p>In Aquarium, this plan will look like:</p>
<img alt="../_images/AquariumPlanExample1.png" src="../_images/AquariumPlanExample1.png" />
<p>Example of planning a large PCR in a IPython jupyter notebook.</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">from</span> <span class="nn">pydent</span> <span class="k">import</span> <span class="n">planner</span>
<span class="kn">from</span> <span class="nn">mysession</span> <span class="k">import</span> <span class="n">production</span>

<span class="n">sample_range</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">25589</span><span class="p">,</span> <span class="mi">25604</span><span class="p">))</span>
<span class="n">canvas</span> <span class="o">=</span> <span class="n">planner</span><span class="o">.</span><span class="n">Planner</span><span class="p">(</span><span class="n">production</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">set_primer</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="n">field_value</span><span class="p">,</span> <span class="n">sample</span><span class="p">):</span>
    <span class="n">canvas</span><span class="o">.</span><span class="n">set_field_value</span><span class="p">(</span><span class="n">field_value</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="n">sample</span><span class="p">)</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sample</span><span class="o">.</span><span class="n">items</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">location</span> <span class="o">!=</span> <span class="s1">&#39;deleted&#39;</span><span class="p">]</span>
    <span class="n">primer_stocks</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">object_type</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Primer Stock&quot;</span><span class="p">]</span>
    <span class="n">primer_aliquots</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">object_type</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Primer Aliquot&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">primer_aliquots</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># set item</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">set_field_value</span><span class="p">(</span><span class="n">field_value</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="n">sample</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">primer_aliquots</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No primer aliquots found for </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">primer_stocks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># create Make Primer Aliquot from Stock</span>
            <span class="n">op</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">create_operation_by_name</span><span class="p">(</span><span class="s2">&quot;Make Primer Aliquot from Stock&quot;</span><span class="p">)</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">add_wire</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">field_value</span><span class="p">)</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">set_field_value</span><span class="p">(</span><span class="n">ops</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sample</span><span class="o">=</span><span class="n">sample</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">primer_stocks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No primer stocks found for </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="c1"># create Order Primer and Rehydrate Primer</span>
            <span class="n">op</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">create_operation_by_name</span><span class="p">(</span><span class="s2">&quot;Order Primer&quot;</span><span class="p">)</span>

            <span class="n">canvas</span><span class="o">.</span><span class="n">set_field_value</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span><span class="p">)</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">set_field_value</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sample</span><span class="o">=</span><span class="n">field_value</span><span class="o">.</span><span class="n">sample</span><span class="p">)</span>
            <span class="n">ops</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">quick_create_chain</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="s2">&quot;Rehydrate Primer&quot;</span><span class="p">)</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">add_wire</span><span class="p">(</span><span class="n">ops</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">field_value</span><span class="p">)</span>
            <span class="k">return</span>


<span class="k">def</span> <span class="nf">submit_pcr</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="n">sample</span><span class="p">):</span>
    <span class="n">op</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">create_operation_by_name</span><span class="p">(</span><span class="s2">&quot;Make PCR Fragment&quot;</span><span class="p">)</span>
    <span class="n">canvas</span><span class="o">.</span><span class="n">set_field_value</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sample</span><span class="o">=</span><span class="n">sample</span><span class="p">)</span>

    <span class="n">fwd</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s1">&#39;Forward Primer&#39;</span><span class="p">]</span>
    <span class="n">rev</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s1">&#39;Reverse Primer&#39;</span><span class="p">]</span>
    <span class="n">template</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s1">&#39;Template&#39;</span><span class="p">]</span>

    <span class="n">set_primer</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="n">op</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="s2">&quot;Forward Primer&quot;</span><span class="p">),</span> <span class="n">fwd</span><span class="p">)</span>
    <span class="n">set_primer</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="n">op</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="s2">&quot;Reverse Primer&quot;</span><span class="p">),</span> <span class="n">rev</span><span class="p">)</span>

    <span class="n">canvas</span><span class="o">.</span><span class="n">set_field_value</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="s2">&quot;Template&quot;</span><span class="p">),</span> <span class="n">sample</span><span class="o">=</span><span class="n">template</span><span class="p">)</span>

    <span class="n">new_ops</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">quick_create_chain</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="s2">&quot;Run Gel&quot;</span><span class="p">,</span> <span class="s2">&quot;Extract Gel Slice&quot;</span><span class="p">,</span> <span class="s2">&quot;Purify Gel Slice&quot;</span><span class="p">)</span>
    <span class="n">run_gel</span> <span class="o">=</span> <span class="n">new_ops</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">canvas</span><span class="o">.</span><span class="n">quick_create_chain</span><span class="p">(</span><span class="s2">&quot;Pour Gel&quot;</span><span class="p">,</span> <span class="n">run_gel</span><span class="p">)</span>


<span class="kn">from</span> <span class="nn">pydent.utils</span> <span class="k">import</span> <span class="n">make_async</span>

<span class="nd">@make_async</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">submit_pcrs</span><span class="p">(</span><span class="n">sample_range</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">sample_id</span> <span class="ow">in</span> <span class="n">sample_range</span><span class="p">:</span>
        <span class="n">submit_pcr</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="n">production</span><span class="o">.</span><span class="n">Sample</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">sample_id</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">[]</span>

<span class="c1"># submit PCR asynchrounous to the canvas</span>
<span class="n">submit_pcrs</span><span class="p">(</span><span class="n">sample_range</span><span class="p">)</span>

<span class="c1"># optimize the plan</span>
<span class="n">canvas</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>

<span class="c1"># topologically sort the layout</span>
<span class="n">canvas</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">topo_sort</span><span class="p">()</span>

<span class="c1"># draw the layout</span>
<span class="n">canvas</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

<span class="c1"># push the plan to Aquarium</span>
<span class="n">canvas</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>

<span class="c1"># display the Aquarium plan url</span>
<span class="n">canvas</span><span class="o">.</span><span class="n">url</span>
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="browsing.html" title="Sample Browsing using Trident"
             >next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installation"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Trident 0.0.34a documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, University of Washington.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>