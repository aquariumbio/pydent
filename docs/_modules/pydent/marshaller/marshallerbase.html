
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>pydent.marshaller.marshallerbase &#8212; Trident 0.0.17 documentation</title>
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Trident 0.0.17 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><p class="sidebar-subtitle">
    <a href="../../../index.html">
        <h1>Trident (V0.0.17)</h1>
    </a>
</p>

<p>
    Trident is a python scripting API wrapper for Aquarium. With Trident,
    you can create python scripts and apps that mine data, create samples,
    submit laboratory protocols, and more. You are looking at documentation
    for version 0.0.17.
</p>
<div>
    <img src="https://circleci.com/gh/klavinslab/trident.svg?style=svg" alt="build status">
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pydent.marshaller.marshallerbase</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">deepcopy</span>

<span class="kn">from</span> <span class="nn">pydent.marshaller.exceptions</span> <span class="k">import</span> <span class="p">(</span><span class="n">MarshallerCallbackNotFoundError</span><span class="p">,</span>
                                          <span class="n">MarshallerRelationshipError</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pydent.marshaller.schema</span> <span class="k">import</span> <span class="n">MODEL_SCHEMA</span>
<span class="kn">from</span> <span class="nn">pydent.utils</span> <span class="k">import</span> <span class="n">pformat</span>


<span class="k">class</span> <span class="nc">MarshallerBase</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for marshalling and unmarshalling. Used in conjunction with</span>
<span class="sd">    :func:`pydent.marshaller.schema.add_schema`</span>

<span class="sd">    Example Usage:</span>


<span class="sd">    .. code-block:: python</span>

<span class="sd">        from pydent.marshaller import MarshallerBase, add_schema</span>

<span class="sd">        @add_schema</span>
<span class="sd">        class UserModel(MarshallerBase):</span>
<span class="sd">            fields = dict(</span>
<span class="sd">                ignore=(&quot;password&quot;,),</span>
<span class="sd">                budgets=Relation(&quot;Budget&quot;, callback=&quot;find_budgets&quot;,</span>
<span class="sd">                                 params=lambda self: self.id)</span>
<span class="sd">            )</span>

<span class="sd">            def find_budgets(user_id):</span>
<span class="sd">                # find budgets with user_id</span>
<span class="sd">                pass</span>

<span class="sd">        # load from JSON</span>
<span class="sd">        u = UserModel.load(user_data)</span>

<span class="sd">        # dump to JSON</span>
<span class="sd">        u.dump()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">model_schema</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">save_attr</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_from_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Special constructor method for instantiating with JSON data</span>

<span class="sd">        :param data: json data to update instance attributes</span>
<span class="sd">        :type data: dict</span>
<span class="sd">        :return: model instance</span>
<span class="sd">        :rtype: MarshallerBase (or subclass)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">inst</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="nb">vars</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">inst</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_schema_class</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the Schema class associated with this model&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">MODEL_SCHEMA</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_schema_instance</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">schema_args</span><span class="p">,</span> <span class="o">**</span><span class="n">schema_kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a Schema instance for loading or dumping&quot;&quot;&quot;</span>
        <span class="n">schema_class</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_schema_class</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">schema_class</span><span class="p">:</span>
            <span class="n">schema</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_schema_class</span><span class="p">()(</span><span class="o">*</span><span class="n">schema_args</span><span class="p">,</span> <span class="o">**</span><span class="n">schema_kwargs</span><span class="p">)</span>
            <span class="n">schema</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">schema_kwargs</span>
            <span class="k">return</span> <span class="n">schema</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_relationships</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the name: relationship</span>
<span class="sd">        (:class:`pydent.marshaller.relation.Relation`)</span>
<span class="sd">        dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">schema_class</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_schema_class</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">schema_class</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_schema_class</span><span class="p">()</span><span class="o">.</span><span class="n">relationships</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">relationships</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the name: relationship</span>
<span class="sd">        (:class:`pydent.marshaller.relation.Relation`)</span>
<span class="sd">        dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">get_relationships</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">only</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">(),</span> <span class="n">all_relations</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">relations</span><span class="o">=</span><span class="p">(),</span> <span class="n">load_only</span><span class="o">=</span><span class="p">(),</span>
             <span class="n">dump_only</span><span class="o">=</span><span class="p">(),</span> <span class="n">partial</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Loads the model instance from JSON. For parameter options, refer to</span>
<span class="sd">        :class:`pydent.marshaller.schema.DynamicSchema`&quot;&quot;&quot;</span>

        <span class="n">schema_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">only</span><span class="o">=</span><span class="n">only</span><span class="p">,</span>
            <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span>
            <span class="n">relations</span><span class="o">=</span><span class="n">relations</span><span class="p">,</span>
            <span class="n">all_relations</span><span class="o">=</span><span class="n">all_relations</span><span class="p">,</span>
            <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span>
            <span class="n">strict</span><span class="o">=</span><span class="n">strict</span><span class="p">,</span>
            <span class="n">many</span><span class="o">=</span><span class="n">many</span><span class="p">,</span>
            <span class="n">load_only</span><span class="o">=</span><span class="n">load_only</span><span class="p">,</span>
            <span class="n">dump_only</span><span class="o">=</span><span class="n">dump_only</span><span class="p">,</span>
            <span class="n">partial</span><span class="o">=</span><span class="n">partial</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">schema_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">schema</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">create_schema_instance</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">schema_kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">schema</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">schema</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>

        <span class="c1"># TODO: violates an invariant, throw an exception</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Cannot dump! No schema attached to &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">only</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="p">(),</span> <span class="n">exclude</span><span class="o">=</span><span class="p">(),</span> <span class="n">relations</span><span class="o">=</span><span class="p">(),</span>
             <span class="n">all_relations</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">many</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">load_only</span><span class="o">=</span><span class="p">(),</span> <span class="n">dump_only</span><span class="o">=</span><span class="p">(),</span>
             <span class="n">partial</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dumps the model instance to a String. For parameter options, refer</span>
<span class="sd">        to :class:`pydent.marshaller.schema.DynamicSchema`</span>

<span class="sd">        :param tuple only: A list or tuple of fields to serialize. If `None`,</span>
<span class="sd">                all non relationship fields will be serialized.</span>
<span class="sd">        :param str|list|tuple|set|dict include: Nested relationships to include</span>
<span class="sd">                in the serialization. This accepts a string (for one nested</span>
<span class="sd">                relationship), a tuple (for multiple relationships) or a dict</span>
<span class="sd">                (for recursively applied serialization). A dictionary of dump</span>
<span class="sd">                options &#39;opts&#39; can be recursively applied to each serialization.</span>
<span class="sd">        :param tuple exclude: A list or tuple of fields to exclude from the</span>
<span class="sd">                serialized result. Nested fields can be represented with dot</span>
<span class="sd">                delimiters.</span>
<span class="sd">        :param tuple relations: A list or tuple of fields to include during</span>
<span class="sd">                serialization. Unlike &#39;include&#39;, this will not be applied</span>
<span class="sd">                recursively</span>
<span class="sd">        :param boolean all_relations: whether to dump all relationship during</span>
<span class="sd">                deserialization</span>
<span class="sd">        :param str prefix: Optional prefix that will be prepended to all the</span>
<span class="sd">                serialized field names.</span>
<span class="sd">        :param bool strict: If `True`, raise errors if invalid data are passed</span>
<span class="sd">                in instead of failing silently and storing the errors.</span>
<span class="sd">        :param bool many: Should be set to `True` if ``obj`` is a collection so</span>
<span class="sd">                that the object will be serialized to a list.</span>
<span class="sd">        :param dict context: Optional context passed to :class:`fields.Method`</span>
<span class="sd">                and :class:`fields.Function` fields.</span>
<span class="sd">        :param tuple load_only: A list or tuple of fields to skip during</span>
<span class="sd">                serialization</span>
<span class="sd">        :param tuple dump_only: A list or tuple of fields to skip during</span>
<span class="sd">                deserialization, read-only fields</span>
<span class="sd">        :param bool|tuple partial: Whether to ignore missing fields. If its</span>
<span class="sd">                value is an iterable, only missing fields listed in that</span>
<span class="sd">                iterable will be ignored.</span>


<span class="sd">        Example Usage using &#39;only&#39; to dump only particular relationships</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            # dump &#39;name&#39; and nested relationship &#39;sample_type&#39;</span>
<span class="sd">            mydump = mymodel.dump(only=(&#39;name&#39;, &#39;sample_type&#39;))</span>

<span class="sd">        Example Usage using &#39;include&#39; to dump nested relationships:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            # dump nested relationships &#39;sample_type&#39; and &#39;samples&#39; in &#39;sample_type&#39;</span>
<span class="sd">            # for &#39;sample_type&#39; dump only &#39;name&#39; in addition to &#39;samples&#39;</span>
<span class="sd">            mydump = mymodel.dump(include={&#39;sample_type&#39;: { &#39;samples&#39;: {}, &#39;opts&#39;: {&#39;only&#39;: [&#39;name&#39;]} } })</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">schema_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">only</span><span class="o">=</span><span class="n">only</span><span class="p">,</span>
            <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span>
            <span class="n">relations</span><span class="o">=</span><span class="n">relations</span><span class="p">,</span>
            <span class="n">all_relations</span><span class="o">=</span><span class="n">all_relations</span><span class="p">,</span>
            <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span>
            <span class="n">strict</span><span class="o">=</span><span class="n">strict</span><span class="p">,</span>
            <span class="n">many</span><span class="o">=</span><span class="n">many</span><span class="p">,</span>
            <span class="n">load_only</span><span class="o">=</span><span class="n">load_only</span><span class="p">,</span>
            <span class="n">dump_only</span><span class="o">=</span><span class="n">dump_only</span><span class="p">,</span>
            <span class="n">partial</span><span class="o">=</span><span class="n">partial</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">schema_kwargs</span><span class="p">))</span>

        <span class="c1"># str to set</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">include</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">include</span> <span class="o">=</span> <span class="p">{</span><span class="n">include</span><span class="p">}</span>

        <span class="c1"># update kwargs from opts</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">include</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">opts</span> <span class="o">=</span> <span class="n">include</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;opts&#39;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">dump_model</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Tries to dump model using dumping parameters</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">MarshallerBase</span><span class="p">):</span>
                <span class="n">_include</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">include</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">_include</span> <span class="o">=</span> <span class="n">include</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">{})</span>
                <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="n">_include</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">model</span>

        <span class="n">dumped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dump</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">include</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relationships</span><span class="p">():</span>
                <span class="n">field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relationships</span><span class="p">()[</span><span class="n">key</span><span class="p">]</span>
                <span class="n">val</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">model</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="n">dump_model</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">model</span><span class="p">]</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">models</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">dump_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">dump_to</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">dump_to</span>
                <span class="n">dumped</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">return</span> <span class="n">dumped</span>

    <span class="k">def</span> <span class="nf">_dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dump helper&quot;&quot;&quot;</span>

        <span class="n">schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">create_schema_instance</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">schema</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">schema</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>

        <span class="c1"># TODO: throw an exception. this is an invariant</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Cannot dump! No schema attached to &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">dumps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">schema_args</span><span class="p">,</span> <span class="o">**</span><span class="n">schema_kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dumps the model instance to a String. For parameter options, refer</span>
<span class="sd">        to :class:`pydent.marshaller.schema.DynamicSchema`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">json_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="o">*</span><span class="n">schema_args</span><span class="p">,</span> <span class="o">**</span><span class="n">schema_kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fullfill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fullfills a relationship with a callback.</span>

<span class="sd">        :param field: relationship field</span>
<span class="sd">        :type field: Relation</span>
<span class="sd">        :return: model that satisfies the relationship</span>
<span class="sd">        :rtype: MarshallerBase</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get function</span>
        <span class="n">callback</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">callback</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">callback</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">callback</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Could not find callback </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2"> in </span><span class="si">{}</span><span class="s2"> instance&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">callback</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
                <span class="n">error</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">msg</span><span class="p">])</span>
                <span class="k">raise</span> <span class="n">MarshallerCallbackNotFoundError</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

        <span class="c1"># get params; pass in self if param is callable</span>
        <span class="n">fxn_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_callback_params</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
        <span class="n">schema_model_name</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">nested</span>
        <span class="k">return</span> <span class="n">callback</span><span class="p">(</span><span class="n">schema_model_name</span><span class="p">,</span> <span class="o">*</span><span class="n">fxn_params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_callback_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
        <span class="n">fxn_params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">field</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">param</span><span class="p">):</span>
                <span class="n">fxn_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fxn_params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fxn_params</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Override for pickling objects&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Override for unpickling objects&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Override attribute accessor to attempt to fullfill relationships.</span>

<span class="sd">        * If the returned attribute is None or [] and the attribute name is in</span>
<span class="sd">        the list of relationships, Trident will attempt to fullfill that relationship.</span>
<span class="sd">        * If AttributeError or TypeError is raise, return the default value&quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">res</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">relationships</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;get_relationships&quot;</span><span class="p">)()</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">relationships</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="k">pass</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves and fullfills relationships if available. This method runs</span>
<span class="sd">        only if the given attribute is not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">relationships</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;get_relationships&quot;</span><span class="p">)()</span>
        <span class="n">save_attr</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;save_attr&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">relationships</span><span class="p">:</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">relationships</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># try to fullfill the relationships</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fullfill</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                <span class="c1"># display warning</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;Could not fullfill relationship for </span><span class="si">{}</span><span class="s2">(instance).</span><span class="si">{}</span><span class="s2"> as relation </span><span class="si">{}</span><span class="se">\n</span><span class="s2">Reasons:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">message</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">args</span><span class="p">):</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;(</span><span class="si">{}</span><span class="s2">) </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
                <span class="n">error</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">msg</span><span class="p">])</span>
                <span class="c1">#warnings.warn(&#39; &#39;.join(error.args))</span>
            <span class="k">if</span> <span class="n">save_attr</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">ret</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ret</span>
        <span class="k">raise</span> <span class="n">MarshallerRelationshipError</span><span class="p">(</span>
            <span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; model has no attribute &#39;</span><span class="si">{}</span><span class="s2">&#39;. Attribute was not found in list of relationships: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span>
                <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">relationships</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>

    <span class="k">def</span> <span class="nf">_relations_to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dump relations to a dictionary.</span>
<span class="sd">        If attribute is None, return the Relation instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dumped</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relationships</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">val</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">field</span>
            <span class="n">dumped</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">return</span> <span class="n">dumped</span>

    <span class="k">def</span> <span class="nf">_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints the model instance in a nice format.</span>
<span class="sd">        See :func:`pydent.marshaller.marshallerbase.dump`</span>

<span class="sd">        :param args: dump arguments</span>
<span class="sd">        :param kwargs: dump arguments</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dumped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_relations_to_json</span><span class="p">()</span>
        <span class="n">_dumped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_dumped</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">_dumped</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dumped</span><span class="p">:</span>
                    <span class="n">dumped</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">return</span> <span class="n">dumped</span>

    <span class="k">def</span> <span class="nf">print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">pformat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_to_dict</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pformat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_to_dict</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">{}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Trident 0.0.17 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, University of Washington.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.2.
    </div>
  </body>
</html>