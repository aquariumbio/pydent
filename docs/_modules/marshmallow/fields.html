
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>marshmallow.fields &#8212; Trident 0.0.22 documentation</title>
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Trident 0.0.22 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><p class="sidebar-subtitle">
    <a href="../../index.html">
        <h1>Trident (V0.0.22)</h1>
    </a>
</p>

<p>
    Trident is a python scripting API wrapper for Aquarium. With Trident,
    you can create python scripts and apps that mine data, create samples,
    submit laboratory protocols, and more. You are looking at documentation
    for version 0.0.22.
</p>
<div>
    <a href="https://circleci.com/gh/klavinslab/trident/tree/master"><img src="https://circleci.com/gh/klavinslab/trident.svg?style=svg" alt="build status"></a>
    <a href="https://badge.fury.io/py/pydent"><img src="https://badge.fury.io/py/pydent.svg" alt="PyPI version" height="18"></a>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for marshmallow.fields</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;Field classes for various types of data.&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">unicode_literals</span>

<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">decimal</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="k">import</span> <span class="n">attrgetter</span>

<span class="kn">from</span> <span class="nn">marshmallow</span> <span class="k">import</span> <span class="n">validate</span><span class="p">,</span> <span class="n">utils</span><span class="p">,</span> <span class="n">class_registry</span>
<span class="kn">from</span> <span class="nn">marshmallow.base</span> <span class="k">import</span> <span class="n">FieldABC</span><span class="p">,</span> <span class="n">SchemaABC</span>
<span class="kn">from</span> <span class="nn">marshmallow.utils</span> <span class="k">import</span> <span class="n">missing</span> <span class="k">as</span> <span class="n">missing_</span>
<span class="kn">from</span> <span class="nn">marshmallow.compat</span> <span class="k">import</span> <span class="n">text_type</span><span class="p">,</span> <span class="n">basestring</span>
<span class="kn">from</span> <span class="nn">marshmallow.exceptions</span> <span class="k">import</span> <span class="n">ValidationError</span>
<span class="kn">from</span> <span class="nn">marshmallow.validate</span> <span class="k">import</span> <span class="n">Validator</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Field&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Raw&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Nested&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Dict&#39;</span><span class="p">,</span>
    <span class="s1">&#39;List&#39;</span><span class="p">,</span>
    <span class="s1">&#39;String&#39;</span><span class="p">,</span>
    <span class="s1">&#39;UUID&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Number&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Integer&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Decimal&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Boolean&#39;</span><span class="p">,</span>
    <span class="s1">&#39;FormattedString&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Float&#39;</span><span class="p">,</span>
    <span class="s1">&#39;DateTime&#39;</span><span class="p">,</span>
    <span class="s1">&#39;LocalDateTime&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Time&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Date&#39;</span><span class="p">,</span>
    <span class="s1">&#39;TimeDelta&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Url&#39;</span><span class="p">,</span>
    <span class="s1">&#39;URL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Email&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Method&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Function&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Str&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Bool&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Int&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Constant&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">MISSING_ERROR_MESSAGE</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s1">&#39;ValidationError raised by `</span><span class="si">{class_name}</span><span class="s1">`, but error key `</span><span class="si">{key}</span><span class="s1">` does &#39;</span>
    <span class="s1">&#39;not exist in the `error_messages` dictionary.&#39;</span>
<span class="p">)</span>
<span class="n">_RECURSIVE_NESTED</span> <span class="o">=</span> <span class="s1">&#39;self&#39;</span>


<span class="k">class</span> <span class="nc">Field</span><span class="p">(</span><span class="n">FieldABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Basic field from which other fields should extend. It applies no</span>
<span class="sd">    formatting by default, and should only be used in cases where</span>
<span class="sd">    data does not need to be formatted before being serialized or deserialized.</span>
<span class="sd">    On error, the name of the field will be returned.</span>

<span class="sd">    :param default: If set, this value will be used during serialization if the input value</span>
<span class="sd">        is missing. If not set, the field will be excluded from the serialized output if the</span>
<span class="sd">        input value is missing. May be a value or a callable.</span>
<span class="sd">    :param str attribute: The name of the attribute to get the value from. If</span>
<span class="sd">        `None`, assumes the attribute has the same name as the field.</span>
<span class="sd">    :param str load_from: Additional key to look for when deserializing. Will only</span>
<span class="sd">        be checked if the field&#39;s name is not found on the input dictionary. If checked,</span>
<span class="sd">        it will return this parameter on error.</span>
<span class="sd">    :param str dump_to: Field name to use as a key when serializing.</span>
<span class="sd">    :param callable validate: Validator or collection of validators that are called</span>
<span class="sd">        during deserialization. Validator takes a field&#39;s input value as</span>
<span class="sd">        its only parameter and returns a boolean.</span>
<span class="sd">        If it returns `False`, an :exc:`ValidationError` is raised.</span>
<span class="sd">    :param required: Raise a :exc:`ValidationError` if the field value</span>
<span class="sd">        is not supplied during deserialization.</span>
<span class="sd">    :param allow_none: Set this to `True` if `None` should be considered a valid value during</span>
<span class="sd">        validation/deserialization. If ``missing=None`` and ``allow_none`` is unset,</span>
<span class="sd">        will default to ``True``. Otherwise, the default is ``False``.</span>
<span class="sd">    :param bool load_only: If `True` skip this field during serialization, otherwise</span>
<span class="sd">        its value will be present in the serialized data.</span>
<span class="sd">    :param bool dump_only: If `True` skip this field during deserialization, otherwise</span>
<span class="sd">        its value will be present in the deserialized object. In the context of an</span>
<span class="sd">        HTTP API, this effectively marks the field as &quot;read-only&quot;.</span>
<span class="sd">    :param missing: Default deserialization value for the field if the field is not</span>
<span class="sd">        found in the input data. May be a value or a callable.</span>
<span class="sd">    :param dict error_messages: Overrides for `Field.default_error_messages`.</span>
<span class="sd">    :param metadata: Extra arguments to be stored as metadata.</span>

<span class="sd">    .. versionchanged:: 2.0.0</span>
<span class="sd">        Removed `error` parameter. Use ``error_messages`` instead.</span>

<span class="sd">    .. versionchanged:: 2.0.0</span>
<span class="sd">        Added `allow_none` parameter, which makes validation/deserialization of `None`</span>
<span class="sd">        consistent across fields.</span>

<span class="sd">    .. versionchanged:: 2.0.0</span>
<span class="sd">        Added `load_only` and `dump_only` parameters, which allow field skipping</span>
<span class="sd">        during the (de)serialization process.</span>

<span class="sd">    .. versionchanged:: 2.0.0</span>
<span class="sd">        Added `missing` parameter, which indicates the value for a field if the field</span>
<span class="sd">        is not found during deserialization.</span>

<span class="sd">    .. versionchanged:: 2.0.0</span>
<span class="sd">        ``default`` value is only used if explicitly set. Otherwise, missing values</span>
<span class="sd">        inputs are excluded from serialized output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Some fields, such as Method fields and Function fields, are not expected</span>
    <span class="c1">#  to exists as attributes on the objects to serialize. Set this to False</span>
    <span class="c1">#  for those fields</span>
    <span class="n">_CHECK_ATTRIBUTE</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">_creation_index</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Used for sorting</span>

    <span class="c1">#: Default error messages for various kinds of errors. The keys in this dictionary</span>
    <span class="c1">#: are passed to `Field.fail`. The values are error messages passed to</span>
    <span class="c1">#: :exc:`marshmallow.ValidationError`.</span>
    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="s1">&#39;Missing data for required field.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Invalid input type.&#39;</span><span class="p">,</span> <span class="c1"># used by Unmarshaller</span>
        <span class="s1">&#39;null&#39;</span><span class="p">:</span> <span class="s1">&#39;Field may not be null.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;validator_failed&#39;</span><span class="p">:</span> <span class="s1">&#39;Invalid value.&#39;</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">missing_</span><span class="p">,</span> <span class="n">attribute</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">load_from</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dump_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">load_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">dump_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">missing</span><span class="o">=</span><span class="n">missing_</span><span class="p">,</span> <span class="n">error_messages</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attribute</span> <span class="o">=</span> <span class="n">attribute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_from</span> <span class="o">=</span> <span class="n">load_from</span>  <span class="c1"># this flag is used by Unmarshaller</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump_to</span> <span class="o">=</span> <span class="n">dump_to</span>  <span class="c1"># this flag is used by Marshaller</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span> <span class="o">=</span> <span class="n">validate</span>
        <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_iterable_but_not_string</span><span class="p">(</span><span class="n">validate</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_generator</span><span class="p">(</span><span class="n">validate</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">validators</span> <span class="o">=</span> <span class="n">validate</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">validators</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">validate</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">validate</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validators</span> <span class="o">=</span> <span class="p">[</span><span class="n">validate</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">validate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validators</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The &#39;validate&#39; parameter must be a callable &quot;</span>
                             <span class="s2">&quot;or a collection of callables.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">required</span> <span class="o">=</span> <span class="n">required</span>
        <span class="c1"># If missing=None, None should be considered valid by default</span>
        <span class="k">if</span> <span class="n">allow_none</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">missing</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span> <span class="o">=</span> <span class="n">allow_none</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_only</span> <span class="o">=</span> <span class="n">load_only</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump_only</span> <span class="o">=</span> <span class="n">dump_only</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">missing</span> <span class="o">=</span> <span class="n">missing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_creation_index</span> <span class="o">=</span> <span class="n">Field</span><span class="o">.</span><span class="n">_creation_index</span>
        <span class="n">Field</span><span class="o">.</span><span class="n">_creation_index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Collect default error message from self and parent classes</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">):</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;default_error_messages&#39;</span><span class="p">,</span> <span class="p">{}))</span>
        <span class="n">messages</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">error_messages</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_messages</span> <span class="o">=</span> <span class="n">messages</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;&lt;fields.</span><span class="si">{ClassName}</span><span class="s1">(default=</span><span class="si">{self.default!r}</span><span class="s1">, &#39;</span>
                <span class="s1">&#39;attribute=</span><span class="si">{self.attribute!r}</span><span class="s1">, &#39;</span>
                <span class="s1">&#39;validate=</span><span class="si">{self.validate}</span><span class="s1">, required=</span><span class="si">{self.required}</span><span class="s1">, &#39;</span>
                <span class="s1">&#39;load_only=</span><span class="si">{self.load_only}</span><span class="s1">, dump_only=</span><span class="si">{self.dump_only}</span><span class="s1">, &#39;</span>
                <span class="s1">&#39;missing=</span><span class="si">{self.missing}</span><span class="s1">, allow_none=</span><span class="si">{self.allow_none}</span><span class="s1">, &#39;</span>
                <span class="s1">&#39;error_messages=</span><span class="si">{self.error_messages}</span><span class="s1">)&gt;&#39;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ClassName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">=</span><span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">accessor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">missing_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the value for a given key from an object.&quot;&quot;&quot;</span>
        <span class="c1"># NOTE: Use getattr instead of direct attribute access here so that</span>
        <span class="c1"># subclasses aren&#39;t required to define `attribute` member</span>
        <span class="n">attribute</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;attribute&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">accessor_func</span> <span class="o">=</span> <span class="n">accessor</span> <span class="ow">or</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_value</span>
        <span class="n">check_key</span> <span class="o">=</span> <span class="n">attr</span> <span class="k">if</span> <span class="n">attribute</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">attribute</span>
        <span class="k">return</span> <span class="n">accessor_func</span><span class="p">(</span><span class="n">check_key</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Perform validation on ``value``. Raise a :exc:`ValidationError` if validation</span>
<span class="sd">        does not succeed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">validator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validators</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">validator</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">validator</span><span class="p">,</span> <span class="n">Validator</span><span class="p">)</span> <span class="ow">and</span> <span class="n">r</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;validator_failed&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">messages</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">messages</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">messages</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Hat tip to django-rest-framework.</span>
    <span class="k">def</span> <span class="nf">fail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A helper method that simply raises a `ValidationError`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_messages</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">class_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">MISSING_ERROR_MESSAGE</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">class_name</span><span class="o">=</span><span class="n">class_name</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validate_missing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate missing values. Raise a :exc:`ValidationError` if</span>
<span class="sd">        `value` should be considered missing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">missing_</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;required&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">required</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;required&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;allow_none&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;null&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">accessor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pulls the value for the given key from the object, applies the</span>
<span class="sd">        field&#39;s formatting and returns the result.</span>

<span class="sd">        :param str attr: The attibute or key to get from the object.</span>
<span class="sd">        :param str obj: The object to pull the key from.</span>
<span class="sd">        :param callable accessor: Function used to pull values from ``obj``.</span>
<span class="sd">        :raise ValidationError: In case of formatting problem</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_CHECK_ATTRIBUTE</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">accessor</span><span class="o">=</span><span class="n">accessor</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">missing_</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">):</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_serialize</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deserialize ``value``.</span>

<span class="sd">        :raise ValidationError: If an invalid value is passed or if a required value</span>
<span class="sd">            is missing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Validate required fields, deserialize, then validate</span>
        <span class="c1"># deserialized value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_missing</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;allow_none&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deserialize</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span>

    <span class="c1"># Methods for concrete classes to override.</span>

    <span class="k">def</span> <span class="nf">_add_to_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update field with values from its parent schema. Called by</span>
<span class="sd">            :meth:`__set_field_attrs &lt;marshmallow.Schema.__set_field_attrs&gt;`.</span>

<span class="sd">        :param str field_name: Field name set in schema.</span>
<span class="sd">        :param Schema schema: Parent schema.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">or</span> <span class="n">schema</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="n">field_name</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Serializes ``value`` to a basic Python datatype. Noop by default.</span>
<span class="sd">        Concrete :class:`Field` classes should implement this method.</span>

<span class="sd">        Example: ::</span>

<span class="sd">            class TitleCase(Field):</span>
<span class="sd">                def _serialize(self, value, attr, obj):</span>
<span class="sd">                    if not value:</span>
<span class="sd">                        return &#39;&#39;</span>
<span class="sd">                    return unicode(value).title()</span>

<span class="sd">        :param value: The value to be serialized.</span>
<span class="sd">        :param str attr: The attribute or key on the object to be serialized.</span>
<span class="sd">        :param object obj: The object the value was pulled from.</span>
<span class="sd">        :raise ValidationError: In case of formatting or validation failure.</span>
<span class="sd">        :return: The serialized value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deserialize value. Concrete :class:`Field` classes should implement this method.</span>

<span class="sd">        :param value: The value to be deserialized.</span>
<span class="sd">        :param str attr: The attribute/key in `data` to be deserialized.</span>
<span class="sd">        :param dict data: The raw input data passed to the `Schema.load`.</span>
<span class="sd">        :raise ValidationError: In case of formatting or validation failure.</span>
<span class="sd">        :return: The deserialized value.</span>

<span class="sd">        .. versionchanged:: 2.0.0</span>
<span class="sd">            Added ``attr`` and ``data`` parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="c1"># Properties</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The context dictionary for the parent :class:`Schema`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">context</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">root</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reference to the `Schema` that this field belongs to even if it is buried in a `List`.</span>
<span class="sd">        Return `None` for unbound fields.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">while</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="s1">&#39;parent&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ret</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">ret</span><span class="o">.</span><span class="n">parent</span>
        <span class="k">return</span> <span class="n">ret</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">SchemaABC</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>

<span class="k">class</span> <span class="nc">Raw</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Field that applies no formatting or validation.&quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Nested</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Allows you to nest a :class:`Schema &lt;marshmallow.Schema&gt;`</span>
<span class="sd">    inside a field.</span>

<span class="sd">    Examples: ::</span>

<span class="sd">        user = fields.Nested(UserSchema)</span>
<span class="sd">        user2 = fields.Nested(&#39;UserSchema&#39;)  # Equivalent to above</span>
<span class="sd">        collaborators = fields.Nested(UserSchema, many=True, only=&#39;id&#39;)</span>
<span class="sd">        parent = fields.Nested(&#39;self&#39;)</span>

<span class="sd">    When passing a `Schema &lt;marshmallow.Schema&gt;` instance as the first argument,</span>
<span class="sd">    the instance&#39;s ``exclude``, ``only``, and ``many`` attributes will be respected.</span>

<span class="sd">    Therefore, when passing the ``exclude``, ``only``, or ``many`` arguments to `fields.Nested`,</span>
<span class="sd">    you should pass a `Schema &lt;marshmallow.Schema&gt;` class (not an instance) as the first argument.</span>

<span class="sd">    ::</span>

<span class="sd">        # Yes</span>
<span class="sd">        author = fields.Nested(UserSchema, only=(&#39;id&#39;, &#39;name&#39;))</span>

<span class="sd">        # No</span>
<span class="sd">        author = fields.Nested(UserSchema(), only=(&#39;id&#39;, &#39;name&#39;))</span>

<span class="sd">    :param Schema nested: The Schema class or class name (string)</span>
<span class="sd">        to nest, or ``&quot;self&quot;`` to nest the :class:`Schema` within itself.</span>
<span class="sd">    :param tuple exclude: A list or tuple of fields to exclude.</span>
<span class="sd">    :param required: Raise an :exc:`ValidationError` during deserialization</span>
<span class="sd">        if the field, *and* any required field values specified</span>
<span class="sd">        in the `nested` schema, are not found in the data. If not a `bool`</span>
<span class="sd">        (e.g. a `str`), the provided value will be used as the message of the</span>
<span class="sd">        :exc:`ValidationError` instead of the default message.</span>
<span class="sd">    :param only: A tuple or string of the field(s) to marshal. If `None`, all fields</span>
<span class="sd">        will be marshalled. If a field name (string) is given, only a single</span>
<span class="sd">        value will be returned as output instead of a dictionary.</span>
<span class="sd">        This parameter takes precedence over ``exclude``.</span>
<span class="sd">    :param bool many: Whether the field is a collection of objects.</span>
<span class="sd">    :param kwargs: The same keyword arguments that :class:`Field` receives.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Invalid type.&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nested</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">missing_</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(),</span> <span class="n">only</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nested</span> <span class="o">=</span> <span class="n">nested</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">only</span> <span class="o">=</span> <span class="n">only</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exclude</span> <span class="o">=</span> <span class="n">exclude</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">many</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;many&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__schema</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Cached Schema instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__updated_fields</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Nested</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The nested Schema object.</span>

<span class="sd">        .. versionchanged:: 1.0.0</span>
<span class="sd">            Renamed from `serializer` to `schema`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__schema</span><span class="p">:</span>
            <span class="c1"># Ensure that only parameter is a tuple</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">only</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                <span class="n">only</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">only</span><span class="p">,)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">only</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">only</span>

            <span class="c1"># Inherit context from parent.</span>
            <span class="n">context</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="s1">&#39;context&#39;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nested</span><span class="p">,</span> <span class="n">SchemaABC</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nested</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__schema</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nested</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="ow">and</span> \
                    <span class="nb">issubclass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nested</span><span class="p">,</span> <span class="n">SchemaABC</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nested</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">many</span><span class="p">,</span>
                        <span class="n">only</span><span class="o">=</span><span class="n">only</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">exclude</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
                        <span class="n">load_only</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_nested_normalized_option</span><span class="p">(</span><span class="s1">&#39;load_only&#39;</span><span class="p">),</span>
                        <span class="n">dump_only</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_nested_normalized_option</span><span class="p">(</span><span class="s1">&#39;dump_only&#39;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nested</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nested</span> <span class="o">==</span> <span class="n">_RECURSIVE_NESTED</span><span class="p">:</span>
                    <span class="n">parent_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="vm">__class__</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__schema</span> <span class="o">=</span> <span class="n">parent_class</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">many</span><span class="p">,</span> <span class="n">only</span><span class="o">=</span><span class="n">only</span><span class="p">,</span>
                            <span class="n">exclude</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">exclude</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
                            <span class="n">load_only</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_nested_normalized_option</span><span class="p">(</span><span class="s1">&#39;load_only&#39;</span><span class="p">),</span>
                            <span class="n">dump_only</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_nested_normalized_option</span><span class="p">(</span><span class="s1">&#39;dump_only&#39;</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">schema_class</span> <span class="o">=</span> <span class="n">class_registry</span><span class="o">.</span><span class="n">get_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nested</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__schema</span> <span class="o">=</span> <span class="n">schema_class</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">many</span><span class="p">,</span>
                            <span class="n">only</span><span class="o">=</span><span class="n">only</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">exclude</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
                            <span class="n">load_only</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_nested_normalized_option</span><span class="p">(</span><span class="s1">&#39;load_only&#39;</span><span class="p">),</span>
                            <span class="n">dump_only</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_nested_normalized_option</span><span class="p">(</span><span class="s1">&#39;dump_only&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Nested fields must be passed a &#39;</span>
                                 <span class="s1">&#39;Schema, not </span><span class="si">{0}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nested</span><span class="o">.</span><span class="vm">__class__</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__schema</span><span class="o">.</span><span class="n">ordered</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="s1">&#39;ordered&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__schema</span>

    <span class="k">def</span> <span class="nf">_nested_normalized_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option_name</span><span class="p">):</span>
        <span class="n">nested_field</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">nested_field</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">option_name</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">nested_field</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nested_obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="c1"># Load up the schema first. This allows a RegistryError to be raised</span>
        <span class="c1"># if an invalid schema name was passed</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span>
        <span class="k">if</span> <span class="n">nested_obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__updated_fields</span><span class="p">:</span>
            <span class="n">schema</span><span class="o">.</span><span class="n">_update_fields</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">nested_obj</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">many</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__updated_fields</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ret</span><span class="p">,</span> <span class="n">errors</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">nested_obj</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">many</span><span class="p">,</span>
                <span class="n">update_fields</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__updated_fields</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">only</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>  <span class="c1"># self.only is a field name</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">many</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">pluck</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">only</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ret</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">only</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">ret</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">many</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_collection</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

        <span class="n">data</span><span class="p">,</span> <span class="n">errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">_validate_missing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate missing values. Raise a :exc:`ValidationError` if</span>
<span class="sd">        `value` should be considered missing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">missing_</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;required&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nested</span> <span class="o">==</span> <span class="n">_RECURSIVE_NESTED</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;required&#39;</span><span class="p">)</span>
            <span class="n">errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_required</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">Nested</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_validate_missing</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_required</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">required</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">field</span><span class="o">.</span><span class="n">required</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">error_field_name</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">load_from</span> <span class="ow">or</span> <span class="n">field_name</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">Nested</span><span class="p">)</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nested</span> <span class="o">!=</span> <span class="n">_RECURSIVE_NESTED</span> <span class="ow">and</span>
                    <span class="n">field</span><span class="o">.</span><span class="n">nested</span> <span class="o">!=</span> <span class="n">_RECURSIVE_NESTED</span>
                <span class="p">):</span>
                    <span class="n">errors</span><span class="p">[</span><span class="n">error_field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">_check_required</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">field</span><span class="o">.</span><span class="n">_validate_missing</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">missing</span><span class="p">)</span>
                    <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">ve</span><span class="p">:</span>
                        <span class="n">errors</span><span class="p">[</span><span class="n">error_field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">ve</span><span class="o">.</span><span class="n">messages</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">many</span> <span class="ow">and</span> <span class="n">errors</span><span class="p">:</span>
                <span class="n">errors</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">errors</span><span class="p">}</span>
            <span class="c1"># No inner errors; just raise required error like normal</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">errors</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;required&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">errors</span>


<span class="k">class</span> <span class="nc">List</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A list field, composed with another `Field` class or</span>
<span class="sd">    instance.</span>

<span class="sd">    Example: ::</span>

<span class="sd">        numbers = fields.List(fields.Float())</span>

<span class="sd">    :param Field cls_or_instance: A field class or instance.</span>
<span class="sd">    :param bool default: Default value for serialization.</span>
<span class="sd">    :param kwargs: The same keyword arguments that :class:`Field` receives.</span>

<span class="sd">    .. versionchanged:: 2.0.0</span>
<span class="sd">        The ``allow_none`` parameter now applies to deserialization and</span>
<span class="sd">        has the same semantics as the other fields.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;invalid&#39;</span><span class="p">:</span> <span class="s1">&#39;Not a valid list.&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cls_or_instance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">List</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cls_or_instance</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">cls_or_instance</span><span class="p">,</span> <span class="n">FieldABC</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The type of the list elements &#39;</span>
                                           <span class="s1">&#39;must be a subclass of &#39;</span>
                                           <span class="s1">&#39;marshmallow.base.FieldABC&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="n">cls_or_instance</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cls_or_instance</span><span class="p">,</span> <span class="n">FieldABC</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The instances of the list &#39;</span>
                                           <span class="s1">&#39;elements must be of type &#39;</span>
                                           <span class="s1">&#39;marshmallow.base.FieldABC&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="n">cls_or_instance</span>

    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">accessor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the value for a given key from an object.&quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">List</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">accessor</span><span class="o">=</span><span class="n">accessor</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">attribute</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_collection</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">attribute</span><span class="p">,</span> <span class="n">each</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">value</span>
                <span class="p">]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_add_to_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">List</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_add_to_schema</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">field_name</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_collection</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">_serialize</span><span class="p">(</span><span class="n">each</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span> <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">_serialize</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_collection</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;invalid&#39;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">each</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">each</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">idx</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">messages</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

<span class="k">class</span> <span class="nc">String</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A string field.</span>

<span class="sd">    :param kwargs: The same keyword arguments that :class:`Field` receives.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;invalid&#39;</span><span class="p">:</span> <span class="s1">&#39;Not a valid string.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;invalid_utf8&#39;</span><span class="p">:</span> <span class="s1">&#39;Not a valid utf-8 string.&#39;</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">ensure_text_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;invalid&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">ensure_text_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;invalid_utf8&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">UUID</span><span class="p">(</span><span class="n">String</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A UUID field.&quot;&quot;&quot;</span>
    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;invalid_uuid&#39;</span><span class="p">:</span> <span class="s1">&#39;Not a valid UUID.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;invalid_guid&#39;</span><span class="p">:</span> <span class="s1">&#39;Not a valid UUID.&#39;</span>  <span class="c1"># TODO: Remove this in marshmallow 3.0</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_validated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Format the value or raise a :exc:`ValidationError` if an error occurs.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;invalid_uuid&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">validated</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_validated</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_serialize</span><span class="p">(</span><span class="n">validated</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validated</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Number</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for number fields.</span>

<span class="sd">    :param bool as_string: If True, format the serialized value as a string.</span>
<span class="sd">    :param kwargs: The same keyword arguments that :class:`Field` receives.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">num_type</span> <span class="o">=</span> <span class="nb">float</span>
    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;invalid&#39;</span><span class="p">:</span> <span class="s1">&#39;Not a valid number.&#39;</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_string</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">as_string</span> <span class="o">=</span> <span class="n">as_string</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Number</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_format_num</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the number value for value, given this field&#39;s `num_type`.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Format the value or raise a :exc:`ValidationError` if an error occurs.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_num</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;invalid&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">accessor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pulls the value for the given key from the object and returns the</span>
<span class="sd">        serialized number representation. Return a string if `self.as_string=True`,</span>
<span class="sd">        othewise return this field&#39;s `num_type`. Receives the same `args` and `kwargs`</span>
<span class="sd">        as `Field`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">Field</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">accessor</span><span class="o">=</span><span class="n">accessor</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_string</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">as_string</span> <span class="ow">and</span> <span class="n">ret</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">missing_</span><span class="p">))</span> <span class="k">else</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">_to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validated</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validated</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Integer</span><span class="p">(</span><span class="n">Number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An integer field.</span>

<span class="sd">    :param kwargs: The same keyword arguments that :class:`Number` receives.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">num_type</span> <span class="o">=</span> <span class="nb">int</span>
    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;invalid&#39;</span><span class="p">:</span> <span class="s1">&#39;Not a valid integer.&#39;</span>
    <span class="p">}</span>


<span class="k">class</span> <span class="nc">Decimal</span><span class="p">(</span><span class="n">Number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A field that (de)serializes to the Python ``decimal.Decimal`` type.</span>
<span class="sd">    It&#39;s safe to use when dealing with money values, percentages, ratios</span>
<span class="sd">    or other numbers where precision is critical.</span>

<span class="sd">    .. warning::</span>

<span class="sd">        This field serializes to a `decimal.Decimal` object by default. If you need</span>
<span class="sd">        to render your data as JSON, keep in mind that the `json` module from the</span>
<span class="sd">        standard library does not encode `decimal.Decimal`. Therefore, you must use</span>
<span class="sd">        a JSON library that can handle decimals, such as `simplejson`, or serialize</span>
<span class="sd">        to a string by passing ``as_string=True``.</span>

<span class="sd">    .. warning::</span>

<span class="sd">        If a JSON `float` value is passed to this field for deserialization it will</span>
<span class="sd">        first be cast to its corresponding `string` value before being deserialized</span>
<span class="sd">        to a `decimal.Decimal` object. The default `__str__` implementation of the</span>
<span class="sd">        built-in Python `float` type may apply a destructive transformation upon</span>
<span class="sd">        its input data and therefore cannot be relied upon to preserve precision.</span>
<span class="sd">        To avoid this, you can instead pass a JSON `string` to be deserialized</span>
<span class="sd">        directly.</span>

<span class="sd">    :param int places: How many decimal places to quantize the value. If `None`, does</span>
<span class="sd">        not quantize the value.</span>
<span class="sd">    :param rounding: How to round the value during quantize, for example</span>
<span class="sd">        `decimal.ROUND_UP`. If None, uses the rounding value from</span>
<span class="sd">        the current thread&#39;s context.</span>
<span class="sd">    :param bool allow_nan: If `True`, `NaN`, `Infinity` and `-Infinity` are allowed,</span>
<span class="sd">        even though they are illegal according to the JSON specification.</span>
<span class="sd">    :param bool as_string: If True, serialize to a string instead of a Python</span>
<span class="sd">        `decimal.Decimal` type.</span>
<span class="sd">    :param kwargs: The same keyword arguments that :class:`Number` receives.</span>

<span class="sd">    .. versionadded:: 1.2.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">num_type</span> <span class="o">=</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span>

    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;special&#39;</span><span class="p">:</span> <span class="s1">&#39;Special numeric values are not permitted.&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rounding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allow_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">as_string</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">places</span> <span class="o">=</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="o">-</span><span class="n">places</span><span class="p">))</span> <span class="k">if</span> <span class="n">places</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rounding</span> <span class="o">=</span> <span class="n">rounding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allow_nan</span> <span class="o">=</span> <span class="n">allow_nan</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Decimal</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">as_string</span><span class="o">=</span><span class="n">as_string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># override Number</span>
    <span class="k">def</span> <span class="nf">_format_num</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">num</span> <span class="o">=</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_nan</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">num</span><span class="o">.</span><span class="n">is_nan</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;NaN&#39;</span><span class="p">)</span>  <span class="c1"># avoid sNaN, -sNaN and -NaN</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">num</span><span class="o">.</span><span class="n">is_nan</span><span class="p">()</span> <span class="ow">or</span> <span class="n">num</span><span class="o">.</span><span class="n">is_infinite</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;special&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">places</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">num</span><span class="o">.</span><span class="n">is_finite</span><span class="p">():</span>
            <span class="n">num</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">places</span><span class="p">,</span> <span class="n">rounding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rounding</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">num</span>

    <span class="c1"># override Number</span>
    <span class="k">def</span> <span class="nf">_validated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Decimal</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_validated</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">decimal</span><span class="o">.</span><span class="n">InvalidOperation</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;invalid&#39;</span><span class="p">)</span>

    <span class="c1"># override Number</span>
    <span class="k">def</span> <span class="nf">_to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">format</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Boolean</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A boolean field.</span>

<span class="sd">    :param kwargs: The same keyword arguments that :class:`Field` receives.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#: Values that will (de)serialize to `True`. If an empty set, any non-falsy</span>
    <span class="c1">#  value will deserialize to `True`.</span>
    <span class="n">truthy</span> <span class="o">=</span> <span class="nb">set</span><span class="p">((</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;True&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
    <span class="c1">#: Values that will (de)serialize to `False`.</span>
    <span class="n">falsy</span> <span class="o">=</span> <span class="nb">set</span><span class="p">((</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span> <span class="s1">&#39;False&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>

    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;invalid&#39;</span><span class="p">:</span> <span class="s1">&#39;Not a valid boolean.&#39;</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">truthy</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">falsy</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">truthy</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">truthy</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">falsy</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;invalid&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">FormattedString</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Interpolate other values from the object into this field. The syntax for</span>
<span class="sd">    the source string is the same as the string `str.format` method</span>
<span class="sd">    from the python stdlib.</span>
<span class="sd">    ::</span>

<span class="sd">        class UserSchema(Schema):</span>
<span class="sd">            name = fields.String()</span>
<span class="sd">            greeting = fields.FormattedString(&#39;Hello {name}&#39;)</span>

<span class="sd">        ser = UserSchema()</span>
<span class="sd">        res = ser.dump(user)</span>
<span class="sd">        res.data  # =&gt; {&#39;name&#39;: &#39;Monty&#39;, &#39;greeting&#39;: &#39;Hello Monty&#39;}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;Cannot format string with given data.&#39;</span>
    <span class="p">}</span>
    <span class="n">_CHECK_ATTRIBUTE</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src_str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">Field</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">src_str</span> <span class="o">=</span> <span class="n">text_type</span><span class="p">(</span><span class="n">src_str</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">to_marshallable_type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">src_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;format&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Float</span><span class="p">(</span><span class="n">Number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A double as IEEE-754 double precision string.</span>

<span class="sd">    :param bool as_string: If True, format the value as a string.</span>
<span class="sd">    :param kwargs: The same keyword arguments that :class:`Number` receives.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">num_type</span> <span class="o">=</span> <span class="nb">float</span>


<span class="k">class</span> <span class="nc">DateTime</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A formatted datetime string in UTC.</span>

<span class="sd">    Example: ``&#39;2014-12-22T03:12:58.019077+00:00&#39;``</span>

<span class="sd">    Timezone-naive `datetime` objects are converted to</span>
<span class="sd">    UTC (+00:00) by :meth:`Schema.dump &lt;marshmallow.Schema.dump&gt;`.</span>
<span class="sd">    :meth:`Schema.load &lt;marshmallow.Schema.load&gt;` returns `datetime`</span>
<span class="sd">    objects that are timezone-aware.</span>

<span class="sd">    :param str format: Either ``&quot;rfc&quot;`` (for RFC822), ``&quot;iso&quot;`` (for ISO8601),</span>
<span class="sd">        or a date format string. If `None`, defaults to &quot;iso&quot;.</span>
<span class="sd">    :param kwargs: The same keyword arguments that :class:`Field` receives.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DATEFORMAT_SERIALIZATION_FUNCS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;iso&#39;</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">isoformat</span><span class="p">,</span>
        <span class="s1">&#39;iso8601&#39;</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">isoformat</span><span class="p">,</span>
        <span class="s1">&#39;rfc&#39;</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">rfcformat</span><span class="p">,</span>
        <span class="s1">&#39;rfc822&#39;</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">rfcformat</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">DATEFORMAT_DESERIALIZATION_FUNCS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;iso&#39;</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">from_iso</span><span class="p">,</span>
        <span class="s1">&#39;iso8601&#39;</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">from_iso</span><span class="p">,</span>
        <span class="s1">&#39;rfc&#39;</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">from_rfc</span><span class="p">,</span>
        <span class="s1">&#39;rfc822&#39;</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">from_rfc</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">DEFAULT_FORMAT</span> <span class="o">=</span> <span class="s1">&#39;iso&#39;</span>

    <span class="n">localtime</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;invalid&#39;</span><span class="p">:</span> <span class="s1">&#39;Not a valid datetime.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;&quot;</span><span class="si">{input}</span><span class="s1">&quot; cannot be formatted as a datetime.&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DateTime</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Allow this to be None. It may be set later in the ``_serialize``</span>
        <span class="c1"># or ``_desrialize`` methods This allows a Schema to dynamically set the</span>
        <span class="c1"># dateformat, e.g. from a Meta option</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dateformat</span> <span class="o">=</span> <span class="nb">format</span>

    <span class="k">def</span> <span class="nf">_add_to_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DateTime</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_add_to_schema</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dateformat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dateformat</span> <span class="ow">or</span> <span class="n">schema</span><span class="o">.</span><span class="n">opts</span><span class="o">.</span><span class="n">dateformat</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dateformat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dateformat</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_FORMAT</span>
        <span class="n">format_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DATEFORMAT_SERIALIZATION_FUNCS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dateformat</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">format_func</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">format_func</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">localtime</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">localtime</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dateformat</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>  <span class="c1"># Falsy values, e.g. &#39;&#39;, None, [] are not valid</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;invalid&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dateformat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dateformat</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_FORMAT</span>
        <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DATEFORMAT_DESERIALIZATION_FUNCS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dateformat</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">func</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;invalid&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dateformat</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dateformat</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;invalid&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">utils</span><span class="o">.</span><span class="n">dateutil_available</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">from_datestring</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;invalid&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;It is recommended that you install python-dateutil &#39;</span>
                          <span class="s1">&#39;for improved datetime deserialization.&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;invalid&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">LocalDateTime</span><span class="p">(</span><span class="n">DateTime</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A formatted datetime string in localized time, relative to UTC.</span>

<span class="sd">        ex. ``&quot;Sun, 10 Nov 2013 08:23:45 -0600&quot;``</span>

<span class="sd">    Takes the same arguments as :class:`DateTime &lt;marshmallow.fields.DateTime&gt;`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">localtime</span> <span class="o">=</span> <span class="kc">True</span>


<span class="k">class</span> <span class="nc">Time</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;ISO8601-formatted time string.</span>

<span class="sd">    :param kwargs: The same keyword arguments that :class:`Field` receives.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;invalid&#39;</span><span class="p">:</span> <span class="s1">&#39;Not a valid time.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;&quot;</span><span class="si">{input}</span><span class="s1">&quot; cannot be formatted as a time.&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">microsecond</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ret</span><span class="p">[:</span><span class="mi">15</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deserialize an ISO8601-formatted time to a :class:`datetime.time` object.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>   <span class="c1"># falsy values are invalid</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;invalid&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">err</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">from_iso_time</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;invalid&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Date</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;ISO8601-formatted date string.</span>

<span class="sd">    :param kwargs: The same keyword arguments that :class:`Field` receives.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;invalid&#39;</span><span class="p">:</span> <span class="s1">&#39;Not a valid date.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;&quot;</span><span class="si">{input}</span><span class="s1">&quot; cannot be formatted as a date.&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deserialize an ISO8601-formatted date string to a</span>
<span class="sd">        :class:`datetime.date` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>  <span class="c1"># falsy values are invalid</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;invalid&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">from_iso_date</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;invalid&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TimeDelta</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A field that (de)serializes a :class:`datetime.timedelta` object to an</span>
<span class="sd">    integer and vice versa. The integer can represent the number of days,</span>
<span class="sd">    seconds or microseconds.</span>

<span class="sd">    :param str precision: Influences how the integer is interpreted during</span>
<span class="sd">        (de)serialization. Must be &#39;days&#39;, &#39;seconds&#39; or &#39;microseconds&#39;.</span>
<span class="sd">    :param str error: Error message stored upon validation failure.</span>
<span class="sd">    :param kwargs: The same keyword arguments that :class:`Field` receives.</span>

<span class="sd">    .. versionchanged:: 2.0.0</span>
<span class="sd">        Always serializes to an integer value to avoid rounding errors.</span>
<span class="sd">        Add `precision` parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">DAYS</span> <span class="o">=</span> <span class="s1">&#39;days&#39;</span>
    <span class="n">SECONDS</span> <span class="o">=</span> <span class="s1">&#39;seconds&#39;</span>
    <span class="n">MICROSECONDS</span> <span class="o">=</span> <span class="s1">&#39;microseconds&#39;</span>

    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;invalid&#39;</span><span class="p">:</span> <span class="s1">&#39;Not a valid period of time.&#39;</span><span class="p">,</span>
        <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{input!r}</span><span class="s1"> cannot be formatted as a timedelta.&#39;</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="s1">&#39;seconds&#39;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">precision</span> <span class="o">=</span> <span class="n">precision</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">units</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DAYS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SECONDS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">MICROSECONDS</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">precision</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">units</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;The precision must be &quot;</span><span class="si">{0}</span><span class="s1">&quot;, &quot;</span><span class="si">{1}</span><span class="s1">&quot; or &quot;</span><span class="si">{2}</span><span class="s1">&quot;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">units</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="n">precision</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TimeDelta</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">days</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">days</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">DAYS</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">days</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">seconds</span> <span class="o">=</span> <span class="n">days</span> <span class="o">*</span> <span class="mi">86400</span> <span class="o">+</span> <span class="n">value</span><span class="o">.</span><span class="n">seconds</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">SECONDS</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">seconds</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># microseconds</span>
                    <span class="k">return</span> <span class="n">seconds</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="mi">6</span> <span class="o">+</span> <span class="n">value</span><span class="o">.</span><span class="n">microseconds</span>  <span class="c1"># flake8: noqa</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;invalid&#39;</span><span class="p">)</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OverflowError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;invalid&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Dict</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A dict field. Supports dicts and dict-like objects.</span>

<span class="sd">    .. note::</span>
<span class="sd">        This field is only appropriate when the structure of</span>
<span class="sd">        nested data is not known. For structured data, use</span>
<span class="sd">        `Nested`.</span>

<span class="sd">    .. versionadded:: 2.1.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;invalid&#39;</span><span class="p">:</span> <span class="s1">&#39;Not a valid mapping type.&#39;</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">Mapping</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s1">&#39;invalid&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ValidatedField</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A field that validates input on serialization.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_validated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Must implement _validate method&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ValidatedField</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_serialize</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validated</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Url</span><span class="p">(</span><span class="n">ValidatedField</span><span class="p">,</span> <span class="n">String</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A validated URL field. Validation occurs during both serialization and</span>
<span class="sd">    deserialization.</span>

<span class="sd">    :param default: Default value for the field if the attribute is not set.</span>
<span class="sd">    :param str attribute: The name of the attribute to get the value from. If</span>
<span class="sd">        `None`, assumes the attribute has the same name as the field.</span>
<span class="sd">    :param bool relative: Allow relative URLs.</span>
<span class="sd">    :param kwargs: The same keyword arguments that :class:`String` receives.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;invalid&#39;</span><span class="p">:</span> <span class="s1">&#39;Not a valid URL.&#39;</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relative</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">schemes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">String</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">relative</span> <span class="o">=</span> <span class="n">relative</span>
        <span class="c1"># Insert validation into self.validators so that multiple errors can be</span>
        <span class="c1"># stored.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validators</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">validate</span><span class="o">.</span><span class="n">URL</span><span class="p">(</span>
            <span class="n">relative</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">relative</span><span class="p">,</span>
            <span class="n">schemes</span><span class="o">=</span><span class="n">schemes</span><span class="p">,</span>
            <span class="n">error</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">error_messages</span><span class="p">[</span><span class="s1">&#39;invalid&#39;</span><span class="p">]</span>
        <span class="p">))</span>

    <span class="k">def</span> <span class="nf">_validated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">validate</span><span class="o">.</span><span class="n">URL</span><span class="p">(</span>
            <span class="n">relative</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">relative</span><span class="p">,</span>
            <span class="n">error</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">error_messages</span><span class="p">[</span><span class="s1">&#39;invalid&#39;</span><span class="p">]</span>
        <span class="p">)(</span><span class="n">value</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Email</span><span class="p">(</span><span class="n">ValidatedField</span><span class="p">,</span> <span class="n">String</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A validated email field. Validation occurs during both serialization and</span>
<span class="sd">    deserialization.</span>

<span class="sd">    :param args: The same positional arguments that :class:`String` receives.</span>
<span class="sd">    :param kwargs: The same keyword arguments that :class:`String` receives.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default_error_messages</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;invalid&#39;</span><span class="p">:</span> <span class="s1">&#39;Not a valid email address.&#39;</span><span class="p">}</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">String</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Insert validation into self.validators so that multiple errors can be</span>
        <span class="c1"># stored.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validators</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">validate</span><span class="o">.</span><span class="n">Email</span><span class="p">(</span><span class="n">error</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">error_messages</span><span class="p">[</span><span class="s1">&#39;invalid&#39;</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">_validated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">validate</span><span class="o">.</span><span class="n">Email</span><span class="p">(</span>
            <span class="n">error</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">error_messages</span><span class="p">[</span><span class="s1">&#39;invalid&#39;</span><span class="p">]</span>
        <span class="p">)(</span><span class="n">value</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Method</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A field that takes the value returned by a `Schema` method.</span>

<span class="sd">    :param str method_name: The name of the Schema method from which</span>
<span class="sd">        to retrieve the value. The method must take an argument ``obj``</span>
<span class="sd">        (in addition to self) that is the object to be serialized.</span>
<span class="sd">    :param str deserialize: Optional name of the Schema method for deserializing</span>
<span class="sd">        a value The method must take a single argument ``value``, which is the</span>
<span class="sd">        value to deserialize.</span>

<span class="sd">    .. versionchanged:: 2.0.0</span>
<span class="sd">        Removed optional ``context`` parameter on methods. Use ``self.context`` instead.</span>
<span class="sd">    .. versionchanged:: 2.3.0</span>
<span class="sd">        Deprecated ``method_name`` parameter in favor of ``serialize`` and allow</span>
<span class="sd">        ``serialize`` to not be passed at all.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_CHECK_ATTRIBUTE</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">serialize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deserialize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">method_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;&quot;method_name&quot; argument of fields.Method is deprecated. &#39;</span>
                          <span class="s1">&#39;Use the &quot;serialize&quot; argument instead.&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">serialize_method_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span> <span class="o">=</span> <span class="n">serialize</span> <span class="ow">or</span> <span class="n">method_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_method_name</span> <span class="o">=</span> <span class="n">deserialize</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Method</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize_method_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">missing_</span>

        <span class="n">method</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">callable_or_raise</span><span class="p">(</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize_method_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">missing_</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_method_name</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">method</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">callable_or_raise</span><span class="p">(</span>
                    <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_method_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">value</span>


<span class="k">class</span> <span class="nc">Function</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A field that takes the value returned by a function.</span>

<span class="sd">    :param callable serialize: A callable from which to retrieve the value.</span>
<span class="sd">        The function must take a single argument ``obj`` which is the object</span>
<span class="sd">        to be serialized. It can also optionally take a ``context`` argument,</span>
<span class="sd">        which is a dictionary of context variables passed to the serializer.</span>
<span class="sd">        If no callable is provided then the ```load_only``` flag will be set</span>
<span class="sd">        to True.</span>
<span class="sd">    :param callable deserialize: A callable from which to retrieve the value.</span>
<span class="sd">        The function must take a single argument ``value`` which is the value</span>
<span class="sd">        to be deserialized. It can also optionally take a ``context`` argument,</span>
<span class="sd">        which is a dictionary of context variables passed to the deserializer.</span>
<span class="sd">        If no callable is provided then ```value``` will be passed through</span>
<span class="sd">        unchanged.</span>
<span class="sd">    :param callable func: This argument is to be deprecated. It exists for</span>
<span class="sd">        backwards compatiblity. Use serialize instead.</span>

<span class="sd">    .. versionchanged:: 2.3.0</span>
<span class="sd">        Deprecated ``func`` parameter in favor of ``serialize``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_CHECK_ATTRIBUTE</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">serialize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deserialize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">func</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;&quot;func&quot; argument of fields.Function is deprecated. &#39;</span>
                          <span class="s1">&#39;Use the &quot;serialize&quot; argument instead.&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
            <span class="n">serialize</span> <span class="o">=</span> <span class="n">func</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Function</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">serialize_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">serialize</span> <span class="ow">and</span> <span class="n">utils</span><span class="o">.</span><span class="n">callable_or_raise</span><span class="p">(</span><span class="n">serialize</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_func</span> <span class="o">=</span> <span class="n">deserialize</span> <span class="ow">and</span> <span class="n">utils</span><span class="o">.</span><span class="n">callable_or_raise</span><span class="p">(</span><span class="n">deserialize</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_or_raise</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">serialize_func</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>  <span class="c1"># the object is not expected to have the attribute</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">missing_</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserialize_func</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_or_raise</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deserialize_func</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_call_or_raise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">get_func_args</span><span class="p">(</span><span class="n">func</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;No context available for Function field </span><span class="si">{0!r}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>



<span class="k">class</span> <span class="nc">Constant</span><span class="p">(</span><span class="n">Field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A field that (de)serializes to a preset constant.  If you only want the</span>
<span class="sd">    constant added for serialization or deserialization, you should use</span>
<span class="sd">    ``dump_only=True`` or ``load_only=True`` respectively.</span>

<span class="sd">    :param constant: The constant to return for the field attribute.</span>

<span class="sd">    .. versionadded:: 2.0.0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_CHECK_ATTRIBUTE</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constant</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Constant</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constant</span> <span class="o">=</span> <span class="n">constant</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">missing</span> <span class="o">=</span> <span class="n">constant</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">constant</span>

    <span class="k">def</span> <span class="nf">_serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant</span>

    <span class="k">def</span> <span class="nf">_deserialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant</span>


<span class="c1"># Aliases</span>
<span class="n">URL</span> <span class="o">=</span> <span class="n">Url</span>
<span class="n">Str</span> <span class="o">=</span> <span class="n">String</span>
<span class="n">Bool</span> <span class="o">=</span> <span class="n">Boolean</span>
<span class="n">Int</span> <span class="o">=</span> <span class="n">Integer</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Trident 0.0.22 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, University of Washington.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>