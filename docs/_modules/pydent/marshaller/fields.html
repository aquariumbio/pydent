<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>pydent.marshaller.fields &#8212; pydent v0.1.2-alpha documentation</title>
    <link rel="stylesheet" href="../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../../_static/bootstrap-sphinx.js "></script>

  </head><body>
    


  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../index.html">
          Trident</a>
        <span class="navbar-text navbar-version pull-left"><b>v0.1.2-alpha</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../index.html">Trident <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../../basics/installation.html">Installing Trident</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/installation.html#installation-for-developers">Installation for developers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../basics/getting_started.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/getting_started.html#logging-into-a-session">Logging into a session</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/getting_started.html#models">Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/getting_started.html#making-queries">Making queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/getting_started.html#relationship-queries">Relationship Queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/getting_started.html#creating-inventory">Creating inventory</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../basics/querying.html">Making Queries</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/querying.html#basic-browsing">Basic Browsing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/querying.html#browser-scope">Browser Scope</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/querying.html#relationship-browsing">Relationship Browsing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/querying.html#logging-requests">Logging Requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../basics/querying.html#asynchrounous-requests">Asynchrounous Requests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../basics/planning.html">Experiment Planning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer/api_reference.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../developer/api_reference.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer/contributing.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../developer/contributing.html#running-tests">Running Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../developer/contributing.html#installing-dependencies">Installing dependencies</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../advanced/topics.html">Advanced topics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../advanced/caching.html">Speeding up queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../advanced/planner_tutorial.html">Planner tutorial</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer/versions.html">Version History</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../developer/versions.html#alpha">0.1.2-alpha</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <h1>Source code for pydent.marshaller.fields</h1><div class="highlight"><pre>
<span></span>&quot;&quot;&quot;
Fields
&quot;&quot;&quot;

from abc import ABC, abstractmethod
from enum import Enum, auto

from pydent.marshaller.descriptors import (
    CallbackAccessor,
    MarshallingAccessor,
    RelationshipAccessor,
    Placeholders,
)
from pydent.marshaller.exceptions import (
    AllowNoneFieldValidationError,
    RunTimeCallbackAttributeError,
)
from pydent.marshaller.registry import ModelRegistry
from pydent.marshaller.utils import make_signature_str


<div class="viewcode-block" id="FieldABC"><a class="viewcode-back" href="../../../developer/_autosummary/_autosummary/pydent.marshaller.fields.html#pydent.marshaller.fields.FieldABC">[docs]</a>class FieldABC(ABC):
    &quot;&quot;&quot;
    Field abstract base class
    &quot;&quot;&quot;

    @abstractmethod
    def serialize(self):
        pass

    @abstractmethod
    def deserialize(self):
        pass

    @abstractmethod
    def _serialize(self):
        pass

    @abstractmethod
    def _deserialize(self):
        pass</div>


<div class="viewcode-block" id="Field"><a class="viewcode-back" href="../../../developer/_autosummary/_autosummary/pydent.marshaller.fields.html#pydent.marshaller.fields.Field">[docs]</a>class Field(FieldABC):
    &quot;&quot;&quot;A serialization/deserialization field.&quot;&quot;&quot;

    ACCESSOR = MarshallingAccessor

    def __init__(
        self, many=None, data_key=None, allow_none=None, default=Placeholders.DEFAULT
    ):
        &quot;&quot;&quot;A standard field. Performs no functions on serialized and
        deserialized data.

        :param many: whether to treat serializations and deserializations as a per-item basis in a list
        :type many: bool
        :param data_key: the data_key, or attribute name, of this field. Calling this as an attribute to the registered
        nested should return this field&#39;s descriptor.
        :type data_key: basestring
        :param allow_none: whether to return None if None is received in deserialization or serializaiton methods
        :type allow_none: bool
        :raises AllowNoneFieldValidationError if None is received in serialize and deserialized methods
        and self.allow_none == False
        &quot;&quot;&quot;

        if allow_none is None:
            allow_none = True
        if many is None:
            many = False
        self.many = many
        self.objtype = None
        self.data_key = data_key
        self.allow_none = allow_none
        self.default = default

    def set_data_key(self, key):
        self.data_key = key

    def _deserialize(self, owner, data):
        return data

    def _serialize(self, owner, data):
        return data

    def deserialize(self, owner, data):
        if data is None:
            if not self.allow_none:
                raise AllowNoneFieldValidationError(
                    &quot;None is not allowed for field &#39;{}&#39;&quot;.format(self.data_key)
                )
            return None
        if self.many:
            for i, x in enumerate(data):
                data[i] = self._deserialize(owner, x)
            return data
        return self._deserialize(owner, data)

    def serialize(self, owner, data):
        if data is None:
            if not self.allow_none:
                raise AllowNoneFieldValidationError(
                    &quot;None is not allowed for field &#39;{}&#39;&quot;.format(self.data_key)
                )
            return None
        if self.many:
            return [self._serialize(owner, d) for d in data]
        return self._serialize(owner, data)

<div class="viewcode-block" id="Field.register"><a class="viewcode-back" href="../../../developer/_autosummary/_autosummary/pydent.marshaller.fields.html#pydent.marshaller.fields.Field.register">[docs]</a>    def register(self, name, objtype):
        &quot;&quot;&quot;Registers the field to a nested class. Instantiates the corresponding
        descriptor (i.e. accessor)

        :param name: name of the field
        :type name: basestring
        :param objtype: the nested class to register the field to
        :type objtype: SchemaModel
        :return: None
        :rtype: None
        &quot;&quot;&quot;

        self.objtype = objtype
        if name not in objtype.__dict__:
            key = name
            if self.data_key:
                key = self.data_key
            setattr(
                objtype,
                name,
                self.ACCESSOR(
                    name=key,
                    field=self,
                    accessor=objtype._data_key,
                    deserialized_accessor=objtype._deserialized_key,
                    default=self.default,
                ),
            )</div>

    def __str__(self):
        return &quot;&lt;{cls} key=&#39;{objtype}.{key}&#39; many={many} allow_none={allow_none}&gt;&quot;.format(
            cls=self.__class__.__name__,
            key=self.data_key,
            many=self.many,
            allow_none=self.allow_none,
            objtype=self.objtype,
        )</div>


<div class="viewcode-block" id="Nested"><a class="viewcode-back" href="../../../developer/_autosummary/_autosummary/pydent.marshaller.fields.html#pydent.marshaller.fields.Nested">[docs]</a>class Nested(Field):
    &quot;&quot;&quot;Represents a field that returns another nested instance.&quot;&quot;&quot;

    def __init__(self, nested, many=None, data_key=None, allow_none=None, lazy=None):
        &quot;&quot;&quot;Nested relationship initializer.

        :param nested: the nested name of nested field. Should exist in the ModelRegistery.
        :type nested: SchemaModel
        :param many: whether to treat serializations and deserializations as a per-item basis in a list
        :type many: bool
        :param data_key: the data_key, or attribute name, of this field. Calling this as an attribute to the registered
        nested should return this field&#39;s descriptor.
        :type data_key: basestring
        :param allow_none: whether to return None if None is received in deserialization or serializaiton methods
        :type allow_none: bool
        :param lazy: if set to True (default), perform lazy serialization and deserialization. If the data received
        by `deserialize` is the expected nested, return that data. If the object
        recieved by `serialize` is not the expected nested, return that data.
        :type lazy:
        &quot;&quot;&quot;

        self.nested = nested
        if lazy is None:
            self.lazy = True
        if allow_none is None:
            allow_none = True
        super().__init__(many, data_key, allow_none)

    def get_model(self):
        return ModelRegistry.get_model(self.nested)

    def _deserialize(self, owner, data):
        if data is None and self.allow_none:
            return None
        elif self.lazy and isinstance(data, self.get_model()):
            return data
        return self.get_model()._set_data(data, owner)

    def _serialize(self, owner, obj):
        if obj is None and self.allow_none:
            return None
        elif self.lazy and not isinstance(obj, self.get_model()):
            return obj
        return obj._get_data()</div>


<div class="viewcode-block" id="Callback"><a class="viewcode-back" href="../../../developer/_autosummary/_autosummary/pydent.marshaller.fields.html#pydent.marshaller.fields.Callback">[docs]</a>class Callback(Field):
    &quot;&quot;&quot;Make a callback when called.&quot;&quot;&quot;

    class __FLAGS(Enum):
        SELF = auto()

    SELF = __FLAGS.SELF
    ACCESSOR = CallbackAccessor

    def __init__(
        self,
        callback,
        callback_args=None,
        callback_kwargs=None,
        cache=False,
        data_key=None,
        many=None,
        allow_none=None,
        always_dump=False,
    ):
        &quot;&quot;&quot;A Callback field initializer.

        :param callback: name of the callback function or a callable. If a name, the name should exist
        as a function in the owner instance. Invalid callback signatures are captures on class creation.
        :type callback: callable|basestring
        :param callback_args: a tuple of arguments to use in the callback. If any of the callback arguments  or
        values of the callback kwargs are callable, the owner will be passed to the callable. The owner instance will
        replace any arguments that are `Callback.SElF`
        :type callback_args: tuple
        :param callback_kwargs: a dictionary of kwargs to use in the callback
        :type callback_kwargs: dict
        :param cache: whether to cache the result using `setattr` on the owner instance. This will initialize the
        serialization and deserialization procedures detailed in the corresponding field/descriptor.
        :type cache: bool
        :param many: whether to treat serializations and deserializations as a per-item basis in a list
        :type many: bool
        :param allow_none: whether to return None if None is received in deserialization or serializaiton methods
        :type allow_none: bool
        :param data_key: the data_key, or attribute name, of this field. Calling this as an attribute to the registered
        nested should return this field&#39;s descriptor.
        :param always_dump: if True, this field will be serialized by default
        :type always_dump: bool
        &quot;&quot;&quot;

        super().__init__(many, data_key, allow_none)
        self.callback = callback
        self.always_dump = always_dump
        if callback_args is None:
            callback_args = tuple()
        elif not isinstance(callback_args, (list, tuple)):
            callback_args = (callback_args,)
        self.callback_args = tuple(callback_args)
        if callback_kwargs is None:
            callback_kwargs = {}
        self.callback_kwargs = dict(callback_kwargs)
        self.cache = cache

    def _callback_signature(self, args=None, kwargs=None):
        if args is None:
            args = self.callback_args
        if kwargs is None:
            kwargs = self.callback_kwargs
        return &quot;{func}{args}&quot;.format(
            func=self.callback, args=make_signature_str(args, kwargs)
        )

<div class="viewcode-block" id="Callback.get_callback_args"><a class="viewcode-back" href="../../../developer/_autosummary/_autosummary/pydent.marshaller.fields.html#pydent.marshaller.fields.Callback.get_callback_args">[docs]</a>    def get_callback_args(self, owner, extra_args=None):
        &quot;&quot;&quot;Processes the callback args&quot;&quot;&quot;
        args = []
        callback_args = list(self.callback_args)
        if extra_args:
            callback_args += list(extra_args)
        try:
            for a in callback_args:
                if a is self.SELF:
                    args.append(owner)
                elif callable(a):
                    args.append(a(owner))
                else:
                    args.append(a)
        except AttributeError as e:
            raise RunTimeCallbackAttributeError(
                &quot;There was an error retrieving callback arguments for &#39;{sig}&#39; due to:\n{e}&quot;.format(
                    sig=self._callback_signature(),
                    e=&quot;{}: {}&quot;.format(e.__class__.__name__, e),
                )
            ) from e
        return args</div>

<div class="viewcode-block" id="Callback.get_callback_kwargs"><a class="viewcode-back" href="../../../developer/_autosummary/_autosummary/pydent.marshaller.fields.html#pydent.marshaller.fields.Callback.get_callback_kwargs">[docs]</a>    def get_callback_kwargs(self, owner, extra_kwargs):
        &quot;&quot;&quot;Processes the callback kwargs&quot;&quot;&quot;
        kwargs = {}
        callback_kwargs = dict(self.callback_kwargs)
        if extra_kwargs:
            callback_kwargs.update(extra_kwargs)
        try:
            for k, v in callback_kwargs.items():
                if callable(v):
                    kwargs[k] = v(owner)
                elif v is self.SELF:
                    kwargs[k] = owner
                else:
                    kwargs[k] = v
        except AttributeError as e:
            raise RunTimeCallbackAttributeError(
                &quot;There was an error retrieving callback keyword arguments for &#39;{func}(args)&#39; due to:\n{e}&quot;.format(
                    func=self.callback,
                    args=self._callback_signature(),
                    e=&quot;{}: {}&quot;.format(e.__class__.__name__, e),
                )
            ) from e
        return kwargs</div>

<div class="viewcode-block" id="Callback.fullfill"><a class="viewcode-back" href="../../../developer/_autosummary/_autosummary/pydent.marshaller.fields.html#pydent.marshaller.fields.Callback.fullfill">[docs]</a>    def fullfill(self, owner, cache=None, extra_args=None, extra_kwargs=None):
        &quot;&quot;&quot;Calls the callback function using the owner object. A
        Callback.SELF arg value will be replaced to be equivalent to the
        owner instance model.

        :param owner: the owning object
        :type owner: SchemaModel
        :return: function result
        :rtype: any
        &quot;&quot;&quot;

        if callable(self.callback):
            func = self.callback
        else:
            func = getattr(owner, self.callback)

        callback_args = self.get_callback_args(owner, extra_args=extra_args)
        callback_kwargs = self.get_callback_kwargs(owner, extra_kwargs=extra_kwargs)

        try:
            val = func(*tuple(callback_args), **callback_kwargs)
        except AttributeError as e:
            raise RunTimeCallbackAttributeError(
                &quot;There was an calling &#39;{signature}&#39; due to:\n{e}&quot;.format(
                    signature=self._callback_signature(callback_args, callback_kwargs),
                    e=&quot;{}: {}&quot;.format(e.__class__.__name__, e),
                )
            ) from e
        if cache is None:
            cache = self.cache
        if cache:
            self.cache_result(owner, val)
        return val</div>

    def cache_result(self, owner, val):
        setattr(owner, self.data_key, val)

    def _deserialize(self, owner, data):
        raise NotImplementedError(
            &quot;_deserialize is not implemented for field {}&quot;.format(self)
        )

    def deserialize(self, *args, **kwargs):
        raise NotImplementedError(
            &quot;deserialize is not implemented for field {}&quot;.format(self)
        )</div>


<div class="viewcode-block" id="Relationship"><a class="viewcode-back" href="../../../developer/_autosummary/_autosummary/pydent.marshaller.fields.html#pydent.marshaller.fields.Relationship">[docs]</a>class Relationship(Callback):
    &quot;&quot;&quot;
    A composition (Callback/Nested) field that uses a callback to retrieve a model.
    &quot;&quot;&quot;

    ACCESSOR = RelationshipAccessor

    def __init__(
        self,
        nested,
        callback,
        callback_args=None,
        callback_kwargs=None,
        cache=True,
        data_key=None,
        many=None,
        allow_none=None,
        always_dump=False,
    ):
        &quot;&quot;&quot;
        Relationship initializer

        :param nested: the nested name of nested field. Should exist in the ModelRegistery.
        :type nested: SchemaModel
        :param callback: name of the callback function or a callable. If a name, the name should exist
        as a function in the owner instance. Invalid callback signatures are captures on class creation.
        :type callback: callable|basestring
        :param callback_args: a tuple of arguments to use in the callback. If any of the callback arguments  or
                                values of the callback kwargs are callable, the owner will be passed to the callable. The owner instance will
                                replace any arguments that are `Callback.SElF`
        :type callback_args: tuple
        :param callback_kwargs: a dictionary of kwargs to use in the callback
        :type callback_kwargs: dict
        :param cache: whether to cache the result using `setattr` on the owner instance. This will initialize the
        serialization and deserialization procedures detailed in the corresponding field/descriptor.
        :type cache: bool
        :param many: whether to treat serializations and deserializations as a per-item basis in a list
        :type many: bool
        :param data_key: the data_key, or attribute name, of this field. Calling this as an attribute to the registered
        nested should return this field&#39;s descriptor.
        &quot;&quot;&quot;

        super().__init__(
            callback,
            callback_args,
            callback_kwargs,
            cache,
            data_key,
            many,
            allow_none,
            always_dump,
        )
        self.nested_field = Nested(nested, many, data_key)
        self.nested = nested
        self.callback_args = tuple([nested] + list(self.callback_args))

    def deserialize(self, owner, val):
        return self.nested_field.deserialize(owner, val)

    def serialize(self, owner, obj):
        return self.nested_field.serialize(owner, obj)</div>


<div class="viewcode-block" id="Alias"><a class="viewcode-back" href="../../../developer/_autosummary/_autosummary/pydent.marshaller.fields.html#pydent.marshaller.fields.Alias">[docs]</a>class Alias(Callback):
    &quot;&quot;&quot;A shallow alias to another field. &quot;&quot;&quot;

    def __init__(self, field_name):
        &quot;&quot;&quot;
        Alias field initialize. Exposes a shallow alias to another field that can be accessed by
        a different attribute key.

        :param field_name: the key of the other field
        :type field_name: basestring
        &quot;&quot;&quot;

        self.alias = field_name
        super().__init__(
            self.alias_callback,
            callback_args=(Callback.SELF, self.alias),
            always_dump=True,
            data_key=field_name,
        )

    @staticmethod
    def alias_callback(m, field_name):
        return getattr(m, field_name)</div>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2017-2019, University of Washington.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>