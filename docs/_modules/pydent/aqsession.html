<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pydent.aqsession &#8212; Trident 0.0.9 documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.0.9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Trident 0.0.9 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><p class="sidebar-subtitle">
    <a href="../../index.html">
        <h1>Trident (V0.0.9)</h1>
    </a>
</p>

<p>
    Trident is a python scripting API wrapper for Aquarium. With Trident,
    you can create python scripts and apps that mine data, create samples,
    submit laboratory protocols, and more. You are looking at documentation
    for version 0.0.9.
</p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pydent.aqsession</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Session class for interacting with Trident and Aquarium</span>

<span class="sd">This module defines the AqSession class, which is the main entry point for</span>
<span class="sd">accessing the request methods.</span>
<span class="sd">Multiple session instances can be created using a user&#39;s Aquarium login</span>
<span class="sd">information.</span>
<span class="sd">From there, the session instance is used to make http requests</span>
<span class="sd">(like finding models, updating plans, etc.)</span>

<span class="sd">AqSession creates SessionInterfaces which can make http requests to Aquarium but</span>
<span class="sd">does not itself make the requests.</span>

<span class="sd">Interfaces are accessed by:</span>

<span class="sd">(1) session.&lt;ModelName&gt; - access the model interface</span>
<span class="sd">(2) session.create - access the create interface</span>
<span class="sd">(3) session.update - access the update interface</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">pydent.aqhttp</span> <span class="k">import</span> <span class="n">AqHTTP</span>
<span class="kn">from</span> <span class="nn">pydent.base</span> <span class="k">import</span> <span class="n">ModelRegistry</span>
<span class="kn">from</span> <span class="nn">pydent.interfaces</span> <span class="k">import</span> <span class="n">ModelInterface</span><span class="p">,</span> <span class="n">UtilityInterface</span>
<span class="kn">from</span> <span class="nn">pydent.models</span> <span class="k">import</span> <span class="n">__all__</span> <span class="k">as</span> <span class="n">allmodels</span>
<span class="kn">from</span> <span class="nn">prompt_toolkit.shortcuts</span> <span class="k">import</span> <span class="n">confirm</span>
<span class="kn">from</span> <span class="nn">prompt_toolkit</span> <span class="k">import</span> <span class="n">prompt</span>


<div class="viewcode-block" id="AqSession"><a class="viewcode-back" href="../../developer/_autosummary/pydent.aqsession.html#pydent.aqsession.AqSession">[docs]</a><span class="k">class</span> <span class="nc">AqSession</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Holds a AqHTTP with login information. Creates SessionInterfaces for models.</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">    session1 = AqSession(username, password, aquairum_url)</span>
<span class="sd">    session1.User.find(1)</span>
<span class="sd">    # &lt;User(id=1,...)&gt;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">login</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">aquarium_url</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param login: the Aquarium login for the user</span>
<span class="sd">        :type login: str</span>
<span class="sd">        :param password: the password for the Aquarium login. This will not be</span>
<span class="sd">            stored anywhere. However, login headers for Aquarium will be stored</span>
<span class="sd">            in .__aqhttp. This may change in the future with changes</span>
<span class="sd">            authentication for the Aquarium API</span>
<span class="sd">        :type password: str</span>
<span class="sd">        :param aquarium_url: the http formatted Aquarium url</span>
<span class="sd">        :type aquarium_url: str</span>
<span class="sd">        :param name: (optional) name for this session</span>
<span class="sd">        :type name: str or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__aqhttp</span> <span class="o">=</span> <span class="n">AqHTTP</span><span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">aquarium_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__current_user</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># initialize model interfaces</span>
        <span class="k">for</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="n">allmodels</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">ModelInterface</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aqhttp</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>

<div class="viewcode-block" id="AqSession.set_timeout"><a class="viewcode-back" href="../../developer/_autosummary/pydent.aqsession.html#pydent.aqsession.AqSession.set_timeout">[docs]</a>    <span class="k">def</span> <span class="nf">set_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout_in_seconds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the request timeout.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__aqhttp</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout_in_seconds</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the aquarium_url for this session&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aqhttp</span><span class="o">.</span><span class="n">aquarium_url</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Logs into aquarium, generating the necessary headers to perform requests</span>
<span class="sd">        to Aquarium</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aqhttp</span><span class="o">.</span><span class="n">login</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="AqSession.interactive"><a class="viewcode-back" href="../../developer/_autosummary/pydent.aqsession.html#pydent.aqsession.AqSession.interactive">[docs]</a>    <span class="k">def</span> <span class="nf">interactive</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Login using prompts and a hidden password (********)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">confirm_register</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">password</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">username</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">url</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">confirm_register</span><span class="p">:</span>
            <span class="n">password</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">confirm_password</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">prompt</span><span class="p">(</span><span class="s1">&#39;enter name for session: &#39;</span><span class="p">)</span>
            <span class="n">username</span> <span class="o">=</span> <span class="n">prompt</span><span class="p">(</span><span class="s1">&#39;enter username: &#39;</span><span class="p">)</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">prompt</span><span class="p">(</span><span class="s1">&#39;enter url: &#39;</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">while</span> <span class="n">confirm_password</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">password</span> <span class="o">!=</span> <span class="n">confirm_password</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">msg</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="n">password</span> <span class="o">=</span> <span class="n">prompt</span><span class="p">(</span><span class="s1">&#39;enter password: &#39;</span><span class="p">,</span> <span class="n">is_password</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">confirm_password</span> <span class="o">=</span> <span class="n">prompt</span><span class="p">(</span>
                    <span class="s1">&#39;confirm password: &#39;</span><span class="p">,</span> <span class="n">is_password</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;passwords did not match!&quot;</span>
            <span class="n">confirm_register</span> <span class="o">=</span> <span class="n">confirm</span><span class="p">(</span>
                <span class="s1">&#39;Confirm registration for </span><span class="si">{}</span><span class="s1">@</span><span class="si">{}</span><span class="s1">? (y/n): &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">url</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;username </span><span class="si">{}</span><span class="s2"> registered&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">login</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span> <span class="n">aquarium_url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">current_user</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the current User associated with this session. Returns None</span>
<span class="sd">        if no user is found (as in cases where the Aquarium connection is down).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_user</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">where</span><span class="p">({</span><span class="s2">&quot;login&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aqhttp</span><span class="o">.</span><span class="n">login</span><span class="p">})</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__current_user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;login&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aqhttp</span><span class="o">.</span><span class="n">login</span><span class="p">})[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__current_user</span>

<div class="viewcode-block" id="AqSession.logged_in"><a class="viewcode-back" href="../../developer/_autosummary/pydent.aqsession.html#pydent.aqsession.AqSession.logged_in">[docs]</a>    <span class="k">def</span> <span class="nf">logged_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns whether the user is logged in. If the session</span>
<span class="sd">        is able to return the User model instance using the</span>
<span class="sd">        session&#39;s login credentials, the user is considered</span>
<span class="sd">        to be logged in.</span>

<span class="sd">        :return: whether user is currently logged in</span>
<span class="sd">        :rtype: boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_user</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">models</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns list of all models available&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">ModelRegistry</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<div class="viewcode-block" id="AqSession.model_interface"><a class="viewcode-back" href="../../developer/_autosummary/pydent.aqsession.html#pydent.aqsession.AqSession.model_interface">[docs]</a>    <span class="k">def</span> <span class="nf">model_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns model interface by name&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ModelInterface</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aqhttp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">utils</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Instantiates a utility interface&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">UtilityInterface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__aqhttp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">{}</span><span class="s2">(name=</span><span class="si">{}</span><span class="s2">, AqHTTP=</span><span class="si">{}</span><span class="s2">))&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aqhttp</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Trident 0.0.9 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, University of Washington.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.1.
    </div>
  </body>
</html>